# HTTPS
HTTP Over TLS
HTTP + TLS
TLS: Transport Layer Security 安全传输层（协议）

TLS创建安全链接步骤：
- 双方协商协议版本、加密算法等细节
- 服务器发送 **证书** 给客户端
- 客户端校验证书有效性
- 双方根据握手的一些参数生成一个 **对称密钥**，此后所有内容使用这个密钥进行加密

## 证书
文件，包含网站的各种信息，如网站域名、证书有效时间、签发机构等。

其中最重要的是
- 用于生成对称密钥的公钥
- 由上级证书签发的签名

证书文件格式为X.509，由 [RFC5280](https://tools.ietf.org/html/rfc5280) 规范详细定义，存储有两种形式，DER（二进制）和PEM（Base64编码）。

密钥生成算法：RSA算法

证书的有效性采用 **信任链** 方法，即 每个终端设备系统都有一个 *根证书*（大部分由Certificate Authority机构颁发，CA），终端系统拿到网站的证书，然后逐层向上查证签发机构的证书，直到找到根证书在系统中存在即可。

由于RSA的非对称性，证书B 由 机构（证书）A签发过程（签发证书）如下：
- 计算B的hash值（任意算法，如SHA1）
- 使用A的私钥对该hash值进行加密，得到A的 *签名*
- 将 *签名* 附在B的证书中

验证B证书的有效性，只需要使用A的公钥对签名进行解密，再计算B的hash值与之比较即可。
证书签发者成为Issuer, 证书持有者称为 Subject

为什么需要中间证书？
因为根证书的私钥安全性最高，不能被泄露。根证书的私钥被保存在离线计算机中，需要时进行拷贝，使用过后再将数据带出来。为了减少根证书私钥的操作次数，就产生了中间证书。
中间证书可以用来大量签发叶证书

浏览器如何获取中间证书？
- 浏览器将网站证书和中间证一并发过来，也就是浏览器访问网站时会收到一系列证书
- 浏览器查找缓存是否存在中间证书，或者查看网站证书的Authority Information Access (AIA) Extension上级证书URL进行下载

所有证书都是有时效的，根证书也是。
根证书过期后，会与各大生厂商合作，再操作系统升级时安装至设备中。

每个证书都有Subject当前证书对象和Issuer证书签发者。
根证书的Subject和Issuer是一致的，即 *自签名*。
